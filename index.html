<head>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
</head>
<body>
    <div id="charts"></div>
    <script>
        $('#charts').bind('mousemove touchmove touchstart', function (e) {
            var chart,
                point,
                i,
                event;

            for (i = 0; i < Highcharts.charts.length; i = i + 1) {
                chart = Highcharts.charts[i];
                // Find coordinates within the chart
                event = chart.pointer.normalize(e.originalEvent);
                // Get the hovered point
                point = chart.series[0].searchPoint(event, true);

                if (point) {
                    point.highlight(e);
                }
            }
        });
        console.log("Hicharts.charts");
        console.log(Highcharts.charts);
        /**
        * Override the reset function, we don't need to hide the tooltips and
        * crosshairs.
        */
        Highcharts.Pointer.prototype.reset = function () {
            return undefined;
        };

        /**
        * Highlight a point by showing tooltip, setting hover state and draw crosshair
        */
        Highcharts.Point.prototype.highlight = function (event) {
            event = this.series.chart.pointer.normalize(event);
            this.onMouseOver(); // Show the hover marker
            this.series.chart.tooltip.refresh(this); // Show the tooltip
            this.series.chart.xAxis[0].drawCrosshair(event, this); // Show the crosshair
        };

        /**
        * Synchronize zooming through the setExtremes event handler.
        */
        function syncExtremes(e) {
            var thisChart = this.chart;

            if (e.trigger !== 'syncExtremes') { // Prevent feedback loop
                Highcharts.each(Highcharts.charts, function (chart) {
                    if (chart !== thisChart) {
                        if (chart.xAxis[0].setExtremes) { // It is null while updating
                            chart.xAxis[0].setExtremes(
                                e.min,
                                e.max,
                                undefined,
                                false,
                                { trigger: 'syncExtremes' }
                            );
                        }
                    }
                });
            }
        }

        // Get the data. The contents of the data file can be viewed at
        $.getJSON(
            'https://cdn.rawgit.com/highcharts/highcharts/057b672172ccc6c08fe7dbb27fc17ebca3f5b770/samples/data/activity.json',
            function (activity) {
                    console.log("activity:");
                console.log(activity);
                $.each(activity.datasets, function (i, dataset) {

                    // Add X values
                    console.log("dataset:");
                    console.log(dataset);
                    dataset.data = Highcharts.map(dataset.data, function (val, j) {
                        return [activity.xData[j], val];
                    });
                    
                    console.log("value at 0.011765");
                    console.log(dataset.data[activity.xData.indexOf(0.011765)][1]);

                    $('<div class="chart">')
                        .appendTo('#charts')
                        .highcharts({
                            chart: {
                                marginLeft: 40, // Keep all charts left aligned
                                spacingTop: 20,
                                spacingBottom: 20
                            },
                            title: {
                                text: dataset.name,
                                align: 'left',
                                margin: 0,
                                x: 30
                            },
                            credits: {
                                enabled: false
                            },
                            legend: {
                                enabled: false
                            },
                            xAxis: {
                                crosshair: true,
                                events: {
                                    setExtremes: syncExtremes
                                },
                                labels: {
                                    format: '{value} km'
                                }
                            },
                            yAxis: {
                                title: {
                                    text: null
                                }
                            },
                            tooltip: {
                                positioner: function () {
                                    return {
                                        // right aligned
                                        x: this.chart.chartWidth - this.label.width,
                                        y: 10 // align to title
                                    };
                                },
                                borderWidth: 0,
                                backgroundColor: 'none',
                                pointFormat: '{point.y}',
                                headerFormat: '',
                                shadow: false,
                                style: {
                                    fontSize: '18px'
                                },
                                valueDecimals: dataset.valueDecimals
                            },
                            series: [{
                                data: dataset.data,
                                name: dataset.name,
                                type: dataset.type,
                                color: Highcharts.getOptions().colors[i],
                                fillOpacity: 0.3,
                                tooltip: {
                                    valueSuffix: ' ' + dataset.unit
                                }
                            }]
                        });
                });
            }
        );

    </script>
</body>